# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting preview on PR
on:
    pull_request:
        branches:
            - master
permissions:
    checks: write
    contents: read
    pull-requests: write
jobs:
    build_and_preview:
        if: ${{ github.event.pull_request.head.repo.full_name == github.repository }}
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
            - name: Setup environment
              uses: SpicyPizza/create-envfile@v2.0.3
              with:
                  file_name: .env
                  envkey_F_API_KEY: ${{ vars.F_API_KEY }}
                  envkey_F_AUTH_DOMAIN: ${{ vars.F_AUTH_DOMAIN }}
                  envkey_F_PROJECT_ID: ${{ vars.F_PROJECT_ID }}
                  envkey_F_STORAGE_BUCKET: ${{ vars.F_STORAGE_BUCKET }}
                  envkey_F_MESSAGING_SENDER_ID: ${{ vars.F_MESSAGING_SENDER_ID }}
                  envkey_F_APP_ID: ${{ vars.F_APP_ID }}
                  envkey_F_MEASUREMENT_ID: ${{ vars.F_MEASUREMENT_ID }}
                  envkey_F_PRIVATE_KEY: ${{ secrets.F_PRIVATE_KEY }}
                  envkey_F_CLIENT_EMAIL: ${{ secrets.F_CLIENT_EMAIL }}
                  envkey_RECAPTCHA_ENTERPRISE_SITE_KEY: ${{ vars.RECAPTCHA_ENTERPRISE_SITE_KEY }}
                  envkey_INSTANCE: "localhost"
                  envkey_COUNTRIES_API: ${{ vars.COUNTRIES_API }}
                  envkey_INDEXABLE: false
                  envkey_DEBUG_APP_CHECK: true
            - name: Install dependencies
              run: corepack enable && yarn
            - name: Build nuxt
              run: yarn build
            - name: Deploy to firebase preview
              uses: FirebaseExtended/action-hosting-deploy@v0
              with:
                  repoToken: ${{ secrets.GITHUB_TOKEN }}
                  firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_JSON  }}
                  projectId: ${{ vars.F_PROJECT_ID }}
                  expires: 30d
